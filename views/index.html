<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>Chat</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                list-style: none;
            }
            section#sec_home {
                display: grid;
                height: 100vh;
                align-items: center;
                text-align: center;
            }
            section#sec_chat {
                display: none;
                grid-template-rows:1fr min-content;
                height: 100vh
            }
            section#sec_chat form {
                display: grid;
                grid-template-columns:1fr min-content;
                padding: 1em;
                background: #9c9;
            }
            section#sec_chat form input {
                padding: 0.5em;
            }
            section#sec_chat form button {
                padding: 0.5em 1.5em;
            }
            div#d_message {
                overflow: auto;
                word-wrap: break-word;
            }
            div#d_message p {
                margin: 0.5em;
                padding: 1em;
                background: #bbd;
                border-radius: 0.5em;
            }
        </style>
    </head>
    <body>
        <section id="sec_home">
            <form id="frm_home">
                <label>Nome: <input placeholder="Digite seu nome" id="i_name" required></label>
                <button>Entrar</button>
            </form>
        </section>
        <section id="sec_chat">
            <div id="d_message"></div>
            <form id="frm_chat">
                <input id="i_message" placeholder="Digite sua mensagem" required>
                <button>Enviar</button>
            </form>
        </section>
    </body>
    <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js" integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>
    <script type="text/javascript" charset="utf-8">
        /*var socket = io.connect();*/
        var socket = io.connect('http://' + document.domain + ':' + location.port);
        var i_name = document.querySelector('#i_name');
        var i_message = document.querySelector('#i_message');
        var sec_home = document.querySelector('#sec_home');
        var frm_home = document.querySelector('#frm_home');
        var sec_chat = document.querySelector('#sec_chat');
        var frm_chat = document.querySelector('#frm_chat');
        var d_message = document.querySelector('#d_message');

        function messageReceive(name, message){
            return '<p><strong>' + name + ': </strong>' + message + '</p>';
        }

        frm_home.addEventListener('submit', function(ev){
            sec_home.style.display = 'none';
            sec_chat.style.display = 'grid';
            ev.preventDefault();
        });

        frm_chat.addEventListener('submit', function(ev){
            socket.emit('message', {
                name: i_name.value,
                message: i_message.value
            });
            ev.preventDefault();
            i_message.value = '';
        });

        socket.on('message', function(data) {
            d_message.innerHTML += messageReceive(data.name, data.message);
        });



    </script>
</html>